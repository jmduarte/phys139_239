\newif\ifshowsolutions
\showsolutionsfalse
\input{../common/preamble}

\chead{
  {\vbox{
      \vspace{2mm}
      \large
      Machine Learning in Physics \hfill
      UCSD PHYS 139/239 \hfill \\[1pt]
      Homework 4\hfill
      Draft version due: Friday, March 3, 2023, 5:00pm\\
	  \hfill
	  Final version due: Wednesday, March 8, 2023, 5:00pm\\
    }
  }
}

\begin{document}
\pagestyle{fancy}

\section*{Policies}

\begin{itemize}
	\item Draft version due 5:00pm, Friday, March 3 on Gradescope (report and code).
	\item Final version due 5:00pm, Wednesday, March 8 on Gradescope (report and code).
	\item You are free to collaborate on all of the problems, subject to the collaboration policy stated in the syllabus.
	\item You should submit all code used in the homework.
	      Please use Python 3 and sklearn version $\geq$0.18 for your code, and that you comment your code such that the TA can follow along and run it without any issues.
\end{itemize}

\section*{Submission Instructions}
\textbf{PLEASE NOTE} that there are two steps to submitting your Homework.
Both must be submitted by the deadline.

\begin{itemize}
	\item Please submit your report as a single .pdf file to Gradescope under ``Homework 4 Report Draft" or ``Homework 4 Report Final".
	      \textbf{In the report, include any images generated by your code along with your answers to the questions.}
	      For instructions specifically pertaining to the Gradescope submission process, see \url{https://www.gradescope.com/get_started#student-submission}.
	\item Please submit your code as a .zip archive to Gradescope under ``Homework 4 Code Draft'' or ``Homework 4 Code Final".
	      The .zip file should contain your code files.
	      Submit your code either as Jupyter notebook .ipynb files or .py files.
\end{itemize}

\newpage
\section{Autoencoder vs. PCA [65 points]}
\materials{lectures 13 and 14}

This problem revisits the hands-on notebook \url{https://github.com/jmduarte/phys139_239/blob/main/notebooks/07_Autoencoder.ipynb}.
For this problem, we will use 50k jet images total (\texttt{max_jets = 50000}) as was done in class.
We \emph{highly recommend} using the GPU-enabled DataHub with the latest \texttt{jmduarte/phys139_239:latest} image for this problem.

\begin{problem}[15]
As discussed in class, the reconstruction loss, i.e. the mean-squared error (MSE), can be interpreted as an \emph{anomaly score}, which roughly tells you how anomalous a jet is.
We can use this anomaly score as a discriminator between QCD jets (background) and top quark jets (signal).
Plot the ROC curve for the MSE loss of the autoencoder on the merged testing sample of QCD and top quark jets.
Assume a label of 1 for top quark jets and a label of 0 for QCD jets.
You can use the existing functions from earlier notebooks or \texttt{sklearn.metrics.roc_curve} and \texttt{sklearn.metrics.auc} directly.
Report the AUC.
\end{problem}


\begin{problem}[25]
Principal component analysis (PCA) is another way of doing dimensionality reduction.
Perform (fit) a PCA on only the QCD training images using \texttt{sklearn.decomposition.PCA} with 2 components.
Note you will have to reshape the image tensors so that they are 2D (as required by PCA) instead of 4D (as required by the autoencoder), e.g. \texttt{qcd_test_images.reshape(-1, im_size * im_size))}.

Plot the distribution of the PCA reconstruction losses for top quark jets and QCD jets, separately, using the testing data.
To evaluate the reconstruction loss, you will have to first apply the PCA transformation (\texttt{transform}) to the QCD and top quark jets, then apply the inverse transformation (\texttt{inverse_transform}) and compare the output with the original input.
You can follow the loss calculation as was done earlier in the notebook for the autoencoder.
The key is to make sure the tensor shapes are correct: at the end you want a single number for each data point representing the loss value for that image.

\begin{hint}
	Review \url{https://rittikghosh.com/autoencoder.html}, which is also relevant for the following parts.
\end{hint}
\end{problem}

\begin{problem}[15]
Plot the ROC curve for the PCA similar to how you did in Problem A.
Report the AUC.
Is it greater or smaller than the AUC achieved by the autoencoder?

\end{problem}

\begin{problem}[25]
Create a scatter plot for the QCD and top quark test images in the 2D latent space for both the autoencoder and the PCA.
Color the data points depending on whether they are QCD or top quarks (i.e. one color for QCD and a different color for top quarks).

For the autoencoder, this will require using the \texttt{encoder} model's {predict} function with the appropriate input(s).

What do you observe about the difference between QCD and top quark jets in these two spaces generally?

How is the 2D space of the autoencoder different from the 2D space of PCA?
\end{problem}

\end{document}
